/*!
* chartjs-plugin-zoom v1.2.1
* undefined
 * (c) 2016-2022 chartjs-plugin-zoom Contributors
 * Released under the MIT License
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("hammerjs"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs","chart.js/helpers"],t):(n="undefined"!=typeof globalThis?globalThis:n||self).ChartZoom=t(n.Chart,n.Hammer,n.Chart.helpers)}(this,(function(n,t,e){"use strict";function o(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var a=o(t);const i=n=>n&&n.enabled&&n.modifierKey,c=(n,t)=>n&&t[n+"Key"],r=(n,t)=>n&&!t[n+"Key"];function l(n,t,e){return void 0===n||("string"==typeof n?-1!==n.indexOf(t):"function"==typeof n&&-1!==n({chart:e}).indexOf(t))}function s(n,t,o){const a=function({x:n,y:t},e){const o=e.scales,a=Object.keys(o);for(let e=0;e<a.length;e++){const i=o[a[e]];if(t>=i.top&&t<=i.bottom&&n>=i.left&&n<=i.right)return i}return null}(t,o);if(a&&l(n,a.axis,o))return[a];const i=[];return e.each(o.scales,(function(t){l(n,t.axis,o)||i.push(t)})),i}const m=new WeakMap;function u(n){let t=m.get(n);return t||(t={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{}},m.set(n,t)),t}function d(n,t,e){const o=n.max-n.min,a=o*(t-1),i=n.isHorizontal()?e.x:e.y,c=Math.max(0,Math.min(1,(n.getValueForPixel(i)-n.min)/o||0));return{min:a*c,max:a*(1-c)}}function f(n,t,o,a,i){let c=o[a];if("original"===c){const o=n.originalScaleLimits[t.id][a];c=e.valueOrDefault(o.options,o.scale)}return e.valueOrDefault(c,i)}function h(n,{min:t,max:e},o,a=!1){const i=u(n.chart),{id:c,axis:r,options:l}=n,s=o&&(o[c]||o[r])||{},m=f(i,n,s,"min",-1/0),d=f(i,n,s,"max",1/0),{minRange:h=0,maxRange:p=d-m}=s,x=t,g=e;if(a){const n=g-x;x<m&&g>d?(t=m,e=d):x<m?(t=m,e=m+Math.min(Math.max(n,h),p)):g>d?(t=d-Math.min(Math.max(n,h),p),e=d):(t=x,e=x+Math.min(Math.max(n,h),p))}else t=x,e=g;return l.min=t,l.max=e,i.updatedScaleLimits[n.id]={min:t,max:e},n.parse(t)!==n.min||n.parse(e)!==n.max}const p=n=>0===n||isNaN(n)?0:n<0?Math.min(Math.round(n),-1):Math.max(Math.round(n),1);const x={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function g(n,t,e,o=!1){const{min:a,max:i,options:c}=n,r=c.time&&c.time.round,l=x[r]||0,s=n.getValueForPixel(n.getPixelForValue(a+l)-t),m=n.getValueForPixel(n.getPixelForValue(i+l)-t),{min:u=-1/0,max:d=1/0}=o&&e&&e[n.axis]||{};return!!(isNaN(s)||isNaN(m)||s<u||m>d)||h(n,{min:s,max:m},e,o)}function b(n,t,e){return g(n,t,e,!0)}const y={category:function(n,t,e,o){const a=d(n,t,e);return n.min===n.max&&t<1&&function(n){const t=n.getLabels().length-1;n.min>0&&(n.min-=1),n.max<t&&(n.max+=1)}(n),h(n,{min:n.min+p(a.min),max:n.max-p(a.max)},o,!0)},default:function(n,t,e,o){const a=d(n,t,e);return h(n,{min:n.min+a.min,max:n.max-a.max},o,!0)}},v={category:function(n,t,e){const o=n.getLabels().length-1;let{min:a,max:i}=n;const c=Math.max(i-a,1),r=Math.round(function(n){return n.isHorizontal()?n.width:n.height}(n)/Math.max(c,10)),l=Math.round(Math.abs(t/r));let s;return t<-r?(i=Math.min(i+l,o),a=1===c?i:i-c,s=i===o):t>r&&(a=Math.max(0,a-l),i=1===c?a:a+c,s=0===a),h(n,{min:a,max:i},e)||s},default:g,logarithmic:b,timeseries:b};function M(n,t){e.each(n,((e,o)=>{t[o]||delete n[o]}))}function z(n,t){const{scales:o}=n,{originalScaleLimits:a,updatedScaleLimits:i}=t;return e.each(o,(function(n){(function(n,t,e){const{id:o,options:{min:a,max:i}}=n;if(!t[o]||!e[o])return!0;const c=e[o];return c.min!==a||c.max!==i})(n,a,i)&&(a[n.id]={min:{scale:n.min,options:n.options.min},max:{scale:n.max,options:n.options.max}})})),M(a,o),M(i,o),a}function k(n,t,o,a){const i=y[n.type]||y.default;e.callback(i,[n,t,o,a])}function w(n){const t=n.chartArea;return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function S(n,t,o="none"){const{x:a=1,y:i=1,focalPoint:c=w(n)}="number"==typeof t?{x:t,y:t}:t,r=u(n),{options:{limits:m,zoom:d}}=r,{mode:f="xy",overScaleMode:h}=d||{};z(n,r);const p=1!==a&&l(f,"x",n),x=1!==i&&l(f,"y",n),g=h&&s(h,c,n);e.each(g||n.scales,(function(n){n.isHorizontal()&&p?k(n,a,c,m):!n.isHorizontal()&&x&&k(n,i,c,m)})),n.update(o),e.callback(d.onZoom,[{chart:n}])}function P(n,t,e){const o=n.getValueForPixel(t),a=n.getValueForPixel(e);return{min:Math.min(o,a),max:Math.max(o,a)}}function C(n){const t=u(n);let o=1,a=1;return e.each(n.scales,(function(n){const i=function(n,t){const o=n.originalScaleLimits[t];if(!o)return;const{min:a,max:i}=o;return e.valueOrDefault(i.options,i.scale)-e.valueOrDefault(a.options,a.scale)}(t,n.id);if(i){const t=Math.round(i/(n.max-n.min)*100)/100;o=Math.min(o,t),a=Math.max(a,t)}})),o<1?o:a}function j(n,t,o,a){const{panDelta:i}=a,c=i[n.id]||0;e.sign(c)===e.sign(t)&&(t+=c);const r=v[n.type]||v.default;e.callback(r,[n,t,o])?i[n.id]=0:i[n.id]=t}function Z(n,t,o,a="none"){const{x:i=0,y:c=0}="number"==typeof t?{x:t,y:t}:t,r=u(n),{options:{pan:s,limits:m}}=r,{mode:d="xy",onPan:f}=s||{};z(n,r);const h=0!==i&&l(d,"x",n),p=0!==c&&l(d,"y",n);e.each(o||n.scales,(function(n){n.isHorizontal()&&h?j(n,i,m,r):!n.isHorizontal()&&p&&j(n,c,m,r)})),n.update(a),e.callback(f,[{chart:n}])}function R(n){const t=u(n),e={};for(const o of Object.keys(n.scales)){const{min:n,max:a}=t.originalScaleLimits[o]||{min:{},max:{}};e[o]={min:n.scale,max:a.scale}}return e}function L(n,t){const{handlers:e}=u(n),o=e[t];o&&o.target&&(o.target.removeEventListener(t,o),delete e[t])}function Y(n,t,e,o){const{handlers:a,options:i}=u(n),c=a[e];c&&c.target===t||(L(n,e),a[e]=t=>o(n,t,i),a[e].target=t,t.addEventListener(e,a[e]))}function O(n,t){const e=u(n);e.dragStart&&(e.dragging=!0,e.dragEnd=t,n.update("none"))}function T(n,t,o){const{onZoomStart:a,onZoomRejected:i}=o;if(a){const{left:o,top:c}=t.target.getBoundingClientRect(),r={x:t.clientX-o,y:t.clientY-c};if(!1===e.callback(a,[{chart:n,event:t,point:r}]))return e.callback(i,[{chart:n,event:t}]),!1}}function X(n,t){const o=u(n),{pan:a,zoom:l={}}=o.options;if(c(i(a),t)||r(i(l.drag),t))return e.callback(l.onZoomRejected,[{chart:n,event:t}]);!1!==T(n,t,l)&&(o.dragStart=t,Y(n,n.canvas,"mousemove",O))}function D(n,t,e,o){const{left:a,top:i}=e.target.getBoundingClientRect(),c=l(t,"x",n),r=l(t,"y",n);let{top:s,left:m,right:u,bottom:d,width:f,height:h}=n.chartArea;c&&(m=Math.min(e.clientX,o.clientX)-a,u=Math.max(e.clientX,o.clientX)-a),r&&(s=Math.min(e.clientY,o.clientY)-i,d=Math.max(e.clientY,o.clientY)-i);const p=u-m,x=d-s;return{left:m,top:s,right:u,bottom:d,width:p,height:x,zoomX:c&&p?1+(f-p)/f:1,zoomY:r&&x?1+(h-x)/h:1}}function E(n,t){const o=u(n);if(!o.dragStart)return;L(n,"mousemove");const{mode:a,onZoomComplete:i,drag:{threshold:c=0}}=o.options.zoom,r=D(n,a,o.dragStart,t),s=l(a,"x",n)?r.width:0,m=l(a,"y",n)?r.height:0,d=Math.sqrt(s*s+m*m);if(o.dragStart=o.dragEnd=null,d<=c)return o.dragging=!1,void n.update("none");!function(n,t,o,a="none"){const i=u(n),{options:{limits:c,zoom:r}}=i,{mode:s="xy"}=r;z(n,i);const m=l(s,"x",n),d=l(s,"y",n);e.each(n.scales,(function(n){n.isHorizontal()&&m?h(n,P(n,t.x,o.x),c,!0):!n.isHorizontal()&&d&&h(n,P(n,t.y,o.y),c,!0)})),n.update(a),e.callback(r.onZoom,[{chart:n}])}(n,{x:r.left,y:r.top},{x:r.right,y:r.bottom},"zoom"),setTimeout((()=>o.dragging=!1),500),e.callback(i,[{chart:n}])}function F(n,t){const{handlers:{onZoomComplete:o},options:{zoom:a}}=u(n);if(!function(n,t,o){if(r(i(o.wheel),t))e.callback(o.onZoomRejected,[{chart:n,event:t}]);else if(!1!==T(n,t,o)&&(t.cancelable&&t.preventDefault(),void 0!==t.deltaY))return!0}(n,t,a))return;const c=t.target.getBoundingClientRect(),l=1+(t.deltaY>=0?-a.wheel.speed:a.wheel.speed);S(n,{x:l,y:l,focalPoint:{x:t.clientX-c.left,y:t.clientY-c.top}}),o&&o()}function H(n,t,o,a){o&&(u(n).handlers[t]=function(n,t){let e;return function(){return clearTimeout(e),e=setTimeout(n,t),t}}((()=>e.callback(o,[{chart:n}])),a))}function V(n,t){return function(o,a){const{pan:l,zoom:s={}}=t.options;if(!l||!l.enabled)return!1;const m=a&&a.srcEvent;return!m||(!(!t.panning&&"mouse"===a.pointerType&&(r(i(l),m)||c(i(s.drag),m)))||(e.callback(l.onPanRejected,[{chart:n,event:a}]),!1))}}function B(n,t,e){if(t.scale){const{center:o,pointers:a}=e,i=1/t.scale*e.scale,c=e.target.getBoundingClientRect(),r=function(n,t){const e=Math.abs(n.clientX-t.clientX),o=Math.abs(n.clientY-t.clientY),a=e/o;let i,c;return a>.3&&a<1.7?i=c=!0:e>o?i=!0:c=!0,{x:i,y:c}}(a[0],a[1]),s=t.options.zoom.mode;S(n,{x:r.x&&l(s,"x",n)?i:1,y:r.y&&l(s,"y",n)?i:1,focalPoint:{x:o.x-c.left,y:o.y-c.top}}),t.scale=e.scale}}function K(n,t,e){const o=t.delta;o&&(t.panning=!0,Z(n,{x:e.deltaX-o.x,y:e.deltaY-o.y},t.panScales),t.delta={x:e.deltaX,y:e.deltaY})}const N=new WeakMap;function q(n,t){const o=u(n),i=n.canvas,{pan:c,zoom:r}=t,l=new a.default.Manager(i);r&&r.pinch.enabled&&(l.add(new a.default.Pinch),l.on("pinchstart",(()=>function(n,t){t.options.zoom.pinch.enabled&&(t.scale=1)}(0,o))),l.on("pinch",(t=>B(n,o,t))),l.on("pinchend",(t=>function(n,t,o){t.scale&&(B(n,t,o),t.scale=null,e.callback(t.options.zoom.onZoomComplete,[{chart:n}]))}(n,o,t)))),c&&c.enabled&&(l.add(new a.default.Pan({threshold:c.threshold,enable:V(n,o)})),l.on("panstart",(t=>function(n,t,o){const{enabled:a,overScaleMode:i,onPanStart:c,onPanRejected:r}=t.options.pan;if(!a)return;const l=o.target.getBoundingClientRect(),m={x:o.center.x-l.left,y:o.center.y-l.top};if(!1===e.callback(c,[{chart:n,event:o,point:m}]))return e.callback(r,[{chart:n,event:o}]);t.panScales=i&&s(i,m,n),t.delta={x:0,y:0},clearTimeout(t.panEndTimeout),K(n,t,o)}(n,o,t))),l.on("panmove",(t=>K(n,o,t))),l.on("panend",(()=>function(n,t){t.delta=null,t.panning&&(t.panEndTimeout=setTimeout((()=>t.panning=!1),500),e.callback(t.options.pan.onPanComplete,[{chart:n}]))}(n,o)))),N.set(n,l)}var W={id:"zoom",version:"1.2.1",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(n,t,o){u(n).options=o,Object.prototype.hasOwnProperty.call(o.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),a.default&&q(n,o),n.pan=(t,e,o)=>Z(n,t,e,o),n.zoom=(t,e)=>S(n,t,e),n.zoomScale=(t,e,o)=>function(n,t,e,o="none"){z(n,u(n)),h(n.scales[t],e,void 0,!0),n.update(o)}(n,t,e,o),n.resetZoom=t=>function(n,t="default"){const o=u(n),a=z(n,o);e.each(n.scales,(function(n){const t=n.options;a[n.id]?(t.min=a[n.id].min.options,t.max=a[n.id].max.options):(delete t.min,delete t.max)})),n.update(t),e.callback(o.options.zoom.onZoomComplete,[{chart:n}])}(n,t),n.getZoomLevel=()=>C(n),n.getInitialScaleBounds=()=>R(n),n.isZoomedOrPanned=()=>function(n){const t=R(n);for(const e of Object.keys(n.scales)){const{min:o,max:a}=t[e];if(void 0!==o&&n.scales[e].min!==o)return!0;if(void 0!==a&&n.scales[e].max!==a)return!0}return!1}(n)},beforeEvent(n){const t=u(n);if(t.panning||t.dragging)return!1},beforeUpdate:function(n,t,e){u(n).options=e,function(n,t){const e=n.canvas,{wheel:o,drag:a,onZoomComplete:i}=t.zoom;o.enabled?(Y(n,e,"wheel",F),H(n,"onZoomComplete",i,250)):L(n,"wheel"),a.enabled?(Y(n,e,"mousedown",X),Y(n,e.ownerDocument,"mouseup",E)):(L(n,"mousedown"),L(n,"mousemove"),L(n,"mouseup"))}(n,e)},beforeDatasetsDraw:function(n,t,e){const{dragStart:o,dragEnd:a}=u(n);if(a){const{left:t,top:i,width:c,height:r}=D(n,e.zoom.mode,o,a),l=e.zoom.drag,s=n.ctx;s.save(),s.beginPath(),s.fillStyle=l.backgroundColor||"rgba(225,225,225,0.3)",s.fillRect(t,i,c,r),l.borderWidth>0&&(s.lineWidth=l.borderWidth,s.strokeStyle=l.borderColor||"rgba(225,225,225)",s.strokeRect(t,i,c,r)),s.restore()}},stop:function(n){!function(n){L(n,"mousedown"),L(n,"mousemove"),L(n,"mouseup"),L(n,"wheel"),L(n,"click")}(n),a.default&&function(n){const t=N.get(n);t&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy(),N.delete(n))}(n),function(n){m.delete(n)}(n)},panFunctions:v,zoomFunctions:y};return n.Chart.register(W),W}));
